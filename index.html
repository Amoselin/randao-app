<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>燃道 Rendao | 仁 - 冥想體驗</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#ffffff">
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    
    <style>
        /* --- 設計師風格定義 --- */
        :root {
            --bg-color: #ffffff;
            --primary-text: #2c2c2c;
            --secondary-text: #8a8a8a;
            --line-color: #e0e0e0;
            --accent-color: #6b6b6b; /* 更深一點的灰，提升質感 */
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--primary-text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            /* 防止手機橡皮筋滾動效果 */
            overscroll-behavior: none; 
        }

        #app {
            width: 85%;
            max-width: 360px;
            text-align: center;
            padding: 20px 0;
        }

        /* --- 核心視覺：會呼吸的圓圈 --- */
        .visual-container {
            position: relative;
            width: 260px;
            height: 260px;
            margin: 0 auto 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* 靜態外圈 (細線) */
        .circle-static {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border: 1px solid var(--line-color);
            border-radius: 50%;
            box-sizing: border-box;
        }

        /* 動態呼吸圈 (啟動時出現) */
        .circle-breathing {
            position: absolute;
            top: -2px; left: -2px;
            width: calc(100% + 4px); height: calc(100% + 4px);
            border: 1px solid transparent;
            border-radius: 50%;
            box-sizing: border-box;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        /* 播放狀態下的視覺變化 */
        .is-playing .circle-static {
            border-color: transparent; /* 隱藏靜態圈 */
        }

        .is-playing .circle-breathing {
            opacity: 1;
            border-color: var(--accent-color);
            /* 加入呼吸動畫，週期 8 秒 */
            animation: breathe 8s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(0,0,0,0.03);
        }

        /* 呼吸動畫定義 */
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.08); opacity: 0.4; border-color: var(--line-color); }
        }

        /* --- 文字與計時器 --- */
        .status-label {
            font-size: 0.85rem;
            letter-spacing: 0.25em;
            color: var(--secondary-text);
            text-transform: uppercase;
            margin-bottom: 12px;
            font-weight: 300;
        }

        .time-display {
            font-size: 3.5rem;
            font-weight: 100; /* 極細字體 */
            letter-spacing: -2px;
            font-variant-numeric: tabular-nums; /* 防止數字跳動 */
        }

        /* --- 底部內容區 --- */
        .content-section {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s ease 0.3s forwards;
        }

        .virtue-title {
            font-size: 1.8rem;
            font-weight: 300;
            margin: 0 0 15px 0;
            letter-spacing: 0.1em;
        }

        .virtue-desc {
            font-size: 0.95rem;
            line-height: 1.8;
            color: var(--secondary-text);
            margin-bottom: 35px;
            text-align: justify;
            font-weight: 300;
        }

        /* --- 極簡按鈕優化 --- */
        .btn-play {
            background: transparent;
            border: 1px solid var(--primary-text);
            color: var(--primary-text);
            padding: 14px 45px;
            font-size: 0.9rem;
            letter-spacing: 0.3em;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
        }

        .btn-play::after {
            content: '';
            position: absolute;
            width: 0%; height: 100%;
            top: 0; left: 0;
            background: var(--primary-text);
            z-index: -1;
            transition: all 0.4s ease;
        }

        .btn-play:hover {
            color: #fff;
        }

        .btn-play:hover::after {
            width: 100%;
        }

        .btn-play:active {
            transform: scale(0.98);
        }

        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div id="app">
    <div class="visual-container" :class="{ 'is-playing': isPlaying }">
        <div class="circle-static"></div>
        <div class="circle-breathing"></div>
        
        <div style="z-index: 2;"> <div class="status-label">{{ currentStageLabel }}</div>
            <div class="time-display">{{ formatTime(timer) }}</div>
        </div>
    </div>

    <div class="content-section">
        <h1 class="virtue-title">仁</h1>
        <p class="virtue-desc">
            以溫暖木質香調開啟旅程。<br>
            在呼吸間觀想內心的慈悲與自愛，<br>
            感受生命的柔軟、包容與連結。
        </p>
        
        <button class="btn-play" @click="togglePlay">
            {{ playButtonText }}
        </button>
    </div>

    <audio ref="audioPlayer" src="music-ren.mp3" loop playsinline preload="auto"></audio>
</div>

<script>
    const { createApp, ref, computed, onUnmounted } = Vue;

    createApp({
        setup() {
            const isPlaying = ref(false);
            const TOTAL_TIME = 900; // 15分鐘 = 900秒
            const timer = ref(TOTAL_TIME);
            const audioPlayer = ref(null);
            let intervalId = null;
            let wakeLock = null;

            // --- 階段狀態定義 ---
            const STAGES = {
                PREPARE: { label: '準備進入', threshold: 900 },
                INTRO:   { label: '開場引導 · 調息', threshold: 720 }, // 前 3 分鐘
                CORE:    { label: '核心觀想 · 仁', threshold: 300 },  // 中間 7 分鐘
                SILENCE: { label: '靜默回神 · 定', threshold: 0 }     // 最後 5 分鐘
            };

            // --- 計算當前階段標籤 ---
            const currentStageLabel = computed(() => {
                if (!isPlaying.value && timer.value === TOTAL_TIME) return STAGES.PREPARE.label;
                if (timer.value > STAGES.INTRO.threshold) return STAGES.INTRO.label;
                if (timer.value > STAGES.CORE.threshold) return STAGES.CORE.label;
                if (timer.value > STAGES.SILENCE.threshold) return STAGES.SILENCE.label;
                return '體驗完成';
            });

            // --- 按鈕文字 ---
            const playButtonText = computed(() => {
                if (timer.value === 0) return '重新開始';
                return isPlaying.value ? '暫停旅程' : (timer.value === TOTAL_TIME ? '啟動燃道' : '繼續旅程');
            });

            // --- 時間格式化 (MM:SS) ---
            const formatTime = (s) => {
                const min = Math.floor(s / 60);
                const sec = s % 60;
                return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            };

            // --- 螢幕恆亮控制 ---
            const toggleWakeLock = async (shouldLock) => {
                try {
                    if ('wakeLock' in navigator) {
                        if (shouldLock && !wakeLock) {
                            wakeLock = await navigator.wakeLock.request('screen');
                        } else if (!shouldLock && wakeLock) {
                            await wakeLock.release();
                            wakeLock = null;
                        }
                    }
                } catch (err) {
                    console.log('Wake Lock 非必要功能，若失敗不影響使用');
                }
            };

            // --- 核心播放控制 ---
            const togglePlay = () => {
                if (timer.value === 0) reset(); // 結束後點擊則重置

                if (isPlaying.value) {
                    pause();
                } else {
                    play();
                }
            };

            const play = () => {
                isPlaying.value = true;
                audioPlayer.value.play();
                toggleWakeLock(true);
                intervalId = setInterval(() => {
                    if (timer.value > 0) {
                        timer.value--;
                    } else {
                        finish();
                    }
                }, 1000);
            };

            const pause = () => {
                isPlaying.value = false;
                audioPlayer.value.pause();
                toggleWakeLock(false);
                clearInterval(intervalId);
            };

            const finish = () => {
                pause();
                timer.value = 0;
                isPlaying.value = false;
                // 可以在這裡加入結束時的提示音或畫面變化
            };

            const reset = () => {
                pause();
                timer.value = TOTAL_TIME;
                audioPlayer.value.currentTime = 0;
            };

            // 清除計時器與喚醒鎖，防止內存洩漏
            onUnmounted(() => {
                clearInterval(intervalId);
                if (wakeLock) wakeLock.release();
            });

            return { 
                isPlaying, 
                timer, 
                currentStageLabel, 
                playButtonText,
                formatTime, 
                togglePlay, 
                audioPlayer 
            };
        }
    }).mount('#app');
</script>

</body>
</html>